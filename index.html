<!DOCTYPE html>
<html>

<head>
    <title>CSE 5544 Midterm Project</title>
    <script src="https://d3js.org/d3.v4.min.js"></script>
    <style>
    </style>
</head>

<body>

    <div style="display: flex; flex-direction: column; align-items: center">
        <div style="width: 790px; height: 400px; border: black 5px solid; display: inline-block; margin: 5px">
            <div style="position: absolute; margin-top: 3px; margin-left: 3px; font-weight: bold">Click on any position to select it</div>
            <img width='790px' height='400px' src='baseballField.png' usemap='#fieldmap'/>
            <map name="fieldmap">
                <area id="LF" shape="circle" coords="200,110,30" onclick="changePosition('LF')">
                <area id="CF" shape="circle" coords="395,60,30" onclick="changePosition('CF')">
                <area id="RF" shape="circle" coords="590,115,30" onclick="changePosition('RF')">
                <area id="3B" shape="circle" coords="270,205,30" onclick="changePosition('3B')">
                <area id="SS" shape="circle" coords="335,165,30" onclick="changePosition('SS')">
                <area id="2B" shape="circle" coords="455,170,30" onclick="changePosition('2B')">
                <area id="1B" shape="circle" coords="515,210,30" onclick="changePosition('1B')">
                <area id="P" shape="circle" coords="395,245,30" onclick="changePosition('P')">
                <area id="C" shape="circle" coords="395,340,30" onclick="changePosition('C')">
            </map>
        </div>
        <div style="width: 790px; height: 500px; border: black 5px solid; display: inline-block; margin: 5px">
            <div style="height: 35px; border-bottom: black 5px solid; text-align: center; font-weight: bold; font-size: 30px;">
                <p style="display: inline">Current Position: </p><p id="currentPosText" style="display: inline">Left Field</p>
                <div style="font-size: 20px; margin-top: 10px;">
                    <div style="display: inline">Rank by</div>
                    <select style="display: inline">
                        <option>Batting Avg</option>
                        <option>Home Runs</option>
                        <option>Errors</option>
                    </select>
                </div>
                <div style="font-size: 20px; margin-top: 10px;">
                    <div style="display: inline">Year</div>
                    <select onchange="changeYear(this.value)" style="display: inline">
                        <option value="2017">2017</option>
                        <option value="2016">2016</option>
                        <option value="2015">2015</option>
                        <option value="2014">2014</option>
                        <option value="2013">2013</option>
                        <option value="2012">2012</option>
                        <option value="2011">2011</option>
                        <option value="2010">2010</option>
                        <option value="2009">2009</option>
                        <option value="2008">2008</option>
                        <option value="2007">2007</option>
                    </select>
                </div>
            </div>
        </div>
    </div>

    <script type="text/javascript">
        // initialize variables -----------------------------------------------------

        // current selected year. default is 2017, but will be selectable eventually
        var currentYear = '2017';
        // battingDataFiltered will contain players from AL and NL leagues,
        // and players with over 400 at bats 
        var battingDataFiltered;
        // battingCurrentYear will be battingDataFiltered filtered to contain players
        // from whatever the currentYear variable is
        var battingCurrentYear;
        // peopleDataFiltered will contain players from AL and NL leagues
        var peopleDataFiltered;
        // current selected position
        var currentPosition = 'LF';

        // end of variable declarations ---------------------------------------------

        // function definitions -----------------------------------------------------

        // some functions

        // changeYear function called when year drop down is changed
        function changeYear(year) {
            currentYear = year;
            // obtain new data sets for current year
            battingCurrentYear = battingDataFiltered.filter(function(val) {
                return val.yearID == currentYear;
            });
        }

        // changePosition function called when a position is clicked
        function changePosition(pos) {
            currentPosition = pos;
            switch (pos) {
                case 'LF':
                    document.getElementById('currentPosText').innerHTML = 'Left Field';
                break;
                case 'CF':
                    document.getElementById('currentPosText').innerHTML = 'Center Field';
                break;
                case 'RF':
                    document.getElementById('currentPosText').innerHTML = 'Right Field';
                break;
                case '3B':
                    document.getElementById('currentPosText').innerHTML = 'Third Base';
                break;
                case 'SS':
                    document.getElementById('currentPosText').innerHTML = 'Short Stop'; 
                break;
                case '2B':
                    document.getElementById('currentPosText').innerHTML = 'Second Base';
                break;
                case '1B':
                    document.getElementById('currentPosText').innerHTML = 'First Base';
                break;
                case 'P':
                    document.getElementById('currentPosText').innerHTML = 'Pitcher';
                break;
                case 'C':
                    document.getElementById('currentPosText').innerHTML = 'Catcher';
                break;
            }
        }

        // end of function definitions ----------------------------------------------

        // data loading and formatting ----------------------------------------------

        // load people csv
        d3.csv("./data/People.csv", function (d, i, columns) {
            return d;
        }, function (error, data) {
            if (error) throw error;
            var cols = data.columns;
            peopleDataFiltered = data;
        });

        // load batting csv
        d3.csv("./data/Batting.csv", function (d, i, columns) {
            // calculate batting average
            var battingAvg = d.H / d.AB;
            d.BA = battingAvg.toFixed(3);
            return d;
        }, function (error, data) {
            if (error) throw error;
            var cols = data.columns;

            // only consider players who had at least 400 at bats
            battingDataFiltered = data.filter(function(val) {
                return (parseInt(val.AB) > 400);
            });

            // only consider players in modern leagues, American League and National League
            battingDataFiltered = battingDataFiltered.filter(function(val) {
                return val.lgID == 'AL' || val.lgID == 'NL';
            });

            // filter out for 2017
            battingCurrentYear = battingDataFiltered.filter(function(val) {
                return val.yearID == currentYear;
            });

            // sort 2017 data to be ordered from highest batting average to lowest
            battingCurrentYear.sort(function (a, b) { return b.BA - a.BA; });
        });

        // load fielding csv
        d3.csv("./data/Fielding.csv", function (d, i, columns) {
            return d;
        }, function (error, data) {
            if (error) throw error;
            var cols = data.columns;
        });

        // end data loading and formatting ------------------------------------------
    </script>

</body>

</html>